version: "3.9"
networks:
  monitor:
    driver: bridge

services:
#  mysql:
#    build: ./monitor-mysql
#    container_name: mysql
#    networks:
#      - monitor
#    ports:
#      - "9090:3306"
#    volumes:
#      - $PWD/data/mysql/conf:/etc/mysql/
#      - $PWD/data/mysql/data:/var/lib/mysql
#    environment:
#      MYSQL_ROOT_PASSWORD: tx-monitor-gdut-group2
#      MYSQL_DATABASE: monitor

  monitor-storage:
    build: ./monitor-storage
    container_name: storage
    networks:
      - monitor
    ports:
      - "8080:8080"
    volumes:
      - $PWD/data/storage:/data/storage
#    depends_on:
#      - influxdb
#      - mysql

  monitor-alert:
    build: ./monitor-alert
    container_name: alert
    networks:
      - monitor
    ports:
      - "8081:8081"
    volumes:
      - $PWD/data/alert:/data/alert
    depends_on:
#      - redis
      - monitor-storage

  monitor-manage:
    build: ./monitor-manage
    container_name: manage
    networks:
      - monitor
    ports:
      - "8082:8082"
      - "8083:8083"
    volumes:
      - $PWD/data/manage:/data/manage
    depends_on:
      - monitor-alert

  monitor-agent:
    build: ./monitor-agent
    container_name: agent-01
    networks:
      - monitor
    ports:
      - "8085:8085"
    volumes:
      - $PWD/data/agent-01:/data/agent
    depends_on:
      - monitor-manage

  monitor-web:
    build: ./monitor-web
    container_name: web
    networks:
      - monitor
    ports:
      - "8086:80"
    volumes:
      - $PWD/data/web:/usr/share/nginx/html/static
      - $PWD/data/web/nginx:/etc/nginx/conf.d
    depends_on:
      - monitor-agent